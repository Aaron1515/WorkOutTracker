<% if session[:user_id] %>
  <% if @admin && @admin.admin == true %>
    <div class="container">

      <!-- Create flash when successfull in creating workout -->
      <% if flash[:success] %>
      <div class="alert alert-success"><%= flash[:success] %></div>
      <% elsif flash[:error] %>
      <div class="alert alert-error"><%= flash[:error] %></div>
      <% end %>
      <!-- End of flash message -->

      <!-- Title of client -->
      <h1><%= @user.name.capitalize %>'s Progress</h1>
      <h3>(<%= @user.email %>)</h3>
      <a href="/users/<%= @user.id %>/workouts/new">Create New Workout</a>
      <br>
      <br><!-- End of title of client -->

      <!--    Show phase one by one if there is phase -->
      <% if phases && phases.length > 0 %>
        <% phases.each do |phase_num| %>
          <table class="table table-striped">
            <tr>
              <th><a href="#"><h3>Phase <%= phase_num %><h3></a></th>
            </tr>
            <% workout_for_phase = @workouts.where(phase: phase_num) %>

            <!-- Show days one bye one in each phase -->
            <% days = [] %>
            <% workout_for_phase.each do |workout| %>
              <% if workout.day %>
                <% days.push(workout.day) %>
              <% end %>
            <% end %>
            <% days = days.uniq %>
            <% days.sort! %>
            <% days.each do |day| %>
              <tr>
                <th><a href="#">Day <%= day %></a></th>
              </tr>
              <tr>
                <th>Name</th>
                <th>Completed</th>
                <th>Reps</th>
                <th>Sets</th>
                <th>Weight</th>
                <th>Note</th>
              </tr>
              <% per_day_workouts = workout_for_phase.where(day: day) %>
              <% per_day_workouts.each do |workout| %>
                <tr>
                  <td><%= workout.name %><%= "   " %><a href="">Edit</a> | <a href="">Delete</a></td>
                  <td><%= workout.completed ? "Yes" : "No" %></td>
                  <td><%= workout.reps %></td>
                  <td><%= workout.sets %></td>
                  <td><%= workout.weight %></td>
                  <td><%= workout.note %></td>
                </tr>
              <% end %>
            <% end %>
          </table>
        <% end %>    <!-- End of day view -->
      <% end %>  <!-- End of phase view -->


      <%= link_to 'Back', users_path %>
    </div>
    <!-- End of admin view -->
  <% else %>
    <!-- Start of user's view -->
    <center>Congratulations <strong><%= @user.name.capitalize %></strong> For Making It This Far!<br>
    Here is Your Progress:
    </center><br><br>
    <ul class="list-group">
      <center>
        <!-- Single button -->
        <div class="btn-group">
          <button id="show-goals" type="button" class="btn btn-default">Workouts</button>
          <button type="button" class="btn btn-default">Photos</button>
          <button id="show-measurements" type="button" class="btn btn-default">Measurements</button>
          <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Day <span class="caret"></span>
          </button>
          <ul class="dropdown-menu">
            <li><a href="#">Monday</a></li>
            <li><a href="#">Tuesday</a></li>
            <li><a href="#">Wednesday</a></li>
            <li><a href="#">Thursday</a></li>
            <li><a href="#">Friday</a></li>
            <li><a href="#">Saturday</a></li>
            <li><a href="#">Sunday</a></li>
          </ul>
        </div>
      </center>
    </ul>
    <div id="mlist">
      <table id="measurement" class="table table-striped">
        <tr>
          <th>Measurements</th>
          <th></th>
        </tr>
        <tr>
          <th>Item</th>
          <th>Status</th>
        </tr>

        <tr> <!-- Add measurement to iterate last measurements -->
          <td>Weight:</td>
          <td>50 LB</td>
        </tr>
        <tr>
          <td>Body Fat:</td>
          <td>12 %</td>
        </tr>
        <tr>
          <td>Dead Lift:</td>
          <td>12 LB</td>
        </tr>
        <tr>
          <td>Bench Press:</td>
          <td>12 LB</td>
        </tr>
        <tr>
          <td>Squat:</td>
          <td>12 LB</td>
        </tr>
        <tr>
          <td>Lat Pull Down:</td>
          <td>12 LB</td>
        </tr>
      </table>
    </div>
    <div id="glist">
      <% phases.each do |phase_num| %>

        <h1>Phase : <%= phase_num %></h1>
        <% phase_workout = workouts.select {|workout| workout.phase == phase_num} %>

        <% days = [] %>
        <% phase_workout.each do |workout| %>
          <% days.push(workout.day) %>
        <% end %>
        <% days = days.uniq %>
        <% days.sort! %>
        <% days.each do |day| %>
          <h2> Day : <%= day %></h2>
          <% day_workout = phase_workout.select {|workout| workout.day == day} %>
          <% day_workout.each do |workout| %>
            <% if workout.completed == false %>
              <li class="list-group-item list-group-item-success">
                <strong><%= workout.name %></strong>
                <input type="submit" value="Complete" class="btn-xs btn-success pull-right wobtn" name="<%= workout.user_id %>" id="<%= workout.id %>">
              </li>
            <% else %>
              <li class="list-group-item list-group-item-success">
                <strong><%= workout.name %></strong>
              </li>
            <% end %>
            <li class="list-group-item">
              <span class="badge"><%= workout.reps %></span>Reps:
            </li>
            <li class="list-group-item">
              <span class="badge"><%= workout.sets %></span>Sets:
            </li>
            <li class="list-group-item">
              <span class="badge"><%= workout.weight %></span>Weight:
            </li>
          <% end %>
        <% end %>
      <% end %>
    </div>
  <% end %>

  <!-- D3 graph for progress -->
  <hr>
  <h1 class="center">Weight</h1>
  <svg id="visualisation" width="800" height="500"></svg>
    <script type="text/javascript">
    var lineData = [{
      x: 1,
      y: 5
    }, {
      x: 20,
      y: 20
    }, {
      x: 40,
      y: 10
    }, {
      x: 60,
      y: 40
    }, {
      x: 80,
      y: 5
    }, {
      x: 200,
      y: 60
    }];


    var vis = d3.select('#visualisation'),
        WIDTH = 800,
        HEIGHT = 500,
        MARGINS = {
          top: 20,
          right: 20,
          bottom: 20,
          left: 50
        },
        xRange = d3.scale.linear().range([MARGINS.left, WIDTH - MARGINS.right]).domain([d3.min(lineData, function(d) {
          return d.x;
        }), d3.max(lineData, function(d) {
          return d.x;
        })]),
        yRange = d3.scale.linear().range([HEIGHT - MARGINS.top, MARGINS.bottom]).domain([d3.min(lineData, function(d) {
          return d.y;
        }), d3.max(lineData, function(d) {
          return d.y;
        })]),
        xAxis = d3.svg.axis()
          .scale(xRange)
          .tickSize(5)
          .tickSubdivide(true),
        yAxis = d3.svg.axis()
          .scale(yRange)
          .tickSize(5)
          .orient('left')
          .tickSubdivide(true);

    vis.append('svg:g')
      .attr('class', 'x axis')
      .attr('transform', 'translate(0,' + (HEIGHT - MARGINS.bottom) + ')')
      .call(xAxis);

    vis.append('svg:g')
      .attr('class', 'y axis')
      .attr('transform', 'translate(' + (MARGINS.left) + ',0)')
      .call(yAxis);


    var lineFunc = d3.svg.line()
      .x(function(d) {
        return xRange(d.x);
      })
      .y(function(d) {
        return yRange(d.y);
      })
      .interpolate('linear');

    vis.append('svg:path')
      .attr('d', lineFunc(lineData))
      .attr('stroke', 'blue')
      .attr('stroke-width', 2)
      .attr('fill', 'none');

  </script>


<% else %>
  Please <a href="/">Log in</a> or <a href="/users/new">Register</a>
<% end %>


